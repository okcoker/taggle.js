(function(e,t){function a(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a}function n(e,t,a){e.addEventListener?e.removeEventListener(t,a,!1):e.detachEvent?e.detachEvent("on"+t,a):e["on"+t]=null}function o(e,t,o){a(e,t,function(){o(),n(e,t,o)})}function i(e){return e.replace(/^\s+|\s+$/g,"")}function l(e,t,a){return function(){return t.apply(e,a)}}var r={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:null,fontSize:11,tabIndex:1,placeholder:""},s={container:{rect:null,style:null,side_padding:null}},c=function(e,a){var n=this;n.container=e,n.options=n.extend(r,a),n.tags=[],n.list=t.createElement("ul"),n.tag_input_li=t.createElement("li"),n.tag_input=t.createElement("input"),n.placeholder=t.createElement("span"),"string"==typeof e&&(n.container=t.getElementById(e)),n.getMeasurements(),n.setupTextarea(),n.attachEvents()};c.prototype.extend=function(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,a=arguments.length;a>t;t++){var n=arguments[t];for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}},c.prototype.getMeasurements=function(){var t,a=this;s.container.rect=a.container.getBoundingClientRect(),s.container.style=e.getComputedStyle(a.container),t=s.container.style,s.container.side_padding=parseInt(t["padding-left"],10)+parseInt(t["padding-right"],10)},c.prototype.setupTextarea=function(){var e=this;if(e.list.className="taggle_list",e.tag_input.type="text",e.tag_input.className="taggle_input",e.tag_input.tabIndex=e.options.tabIndex,e.placeholder.style.display="none",e.placeholder.classList.add("taggle_placeholder"),e.container.appendChild(e.placeholder),null!==e.options.tags)for(var t=0;e.options.tags.length>t;t++)e.list.innerHTML+='<li class="taggle '+e.options.additionalTagClasses+'">'+e.options.tags[t]+'<a href="javascript:void(0)" class="close">&times;</a>'+'<input type="hidden" value="'+e.options.tags[t]+'" name="'+e.options.hiddenInputName+'"></li>',e.tags.push(e.options.tags[t].toLowerCase());e.options.placeholder&&(e.placeholder.textContent=e.options.placeholder,e.options.tags.length||(e.placeholder.style.opacity=1)),e.tag_input_li.appendChild(e.tag_input),e.list.appendChild(e.tag_input_li),e.container.appendChild(e.list)},c.prototype.attachEvents=function(){var e,t=this;a(t.container,"click",function(){t.tag_input.focus()}),t.tag_input.onfocus=l(t,t.inputFocused),t.tag_input.onblur=l(t,t.inputBlurred),a(t.tag_input,"keydown",l(t,t.keydownEvents)),a(t.tag_input,"keyup",l(t,t.keyupEvents)),e=t.container.querySelectorAll(".close");for(var n=0,i=e.length;i>n;n++)o(e[n],"click",l(t,t.removeTag,[e[n]]))},c.prototype.fixInputWidth=function(){var e,t,a,n,o=this;o.setInputWidth(),t=o.tag_input.getBoundingClientRect(),e=~~s.container.rect.width,a=~~t.left-~~s.container.rect.left,n=s.container.side_padding,o.setInputWidth(e-a-n)},c.prototype.add=function(e){var a,n=this,o=t.createElement("li"),r=t.createElement("a"),s=t.createElement("input"),c=n.tag_input,u=e?e.toLowerCase():i(c.value.toLowerCase());return r.href="javascript:void(0)",r.innerHTML="&times;",r.className="close",r.onclick=l(n,n.removeTag,[r]),o.innerHTML=u,o.className="taggle "+n.options.additionalTagClasses,s.type="hidden",s.value=u,s.name=n.options.hiddenInputName,n.tags.push(u),o.appendChild(r),o.appendChild(s),a=n.list.querySelector("li:last-child"),n.list.insertBefore(o,a),n.tag_input.value="",n.setInputWidth(),n.fixInputWidth(),n},c.prototype.chargeLastTag=function(t){t=t||e.event;var a=this,n=a.container.querySelectorAll(".taggle"),o=n[n.length-1],i="hot";""===a.tag_input.value&&8===t.keyCode?o.classList.contains(i)?(a.removeFromTheTags(o),o.remove(),a.fixInputWidth()):o.classList.add(i):o.classList.contains(i)&&o.classList.remove(i)},c.prototype.removeFromTheTags=function(e){var t=this,a="a"===e.tagName.toLowerCase()?e.parentNode:e,n=a.textContent||a.innerText;n=n.slice(0,-1),t.tags.splice(t.tags.indexOf(n),1)},c.prototype.setInputWidth=function(e){this.tag_input.style.width=(e||10)+"px"},c.prototype.checkForDupes=function(e){var t=this,a=t.tag_input.value,n=e?e.toLowerCase():i(a.toLowerCase()),o=t.tags.indexOf(n),l=t.container.querySelector(".taggle_list"),r=l.querySelectorAll("."+t.options.duplicateTagClass);if(t.options.duplicateTagClass&&r.length)for(var s=0,c=r.length;c>s;s++)r[s].classList.remove(t.options.duplicateTagClass);return o>-1?(t.options.duplicateTagClass&&l.childNodes[o].classList.add(t.options.duplicateTagClass),!0):!1},c.prototype.isConfirmKey=function(e){var t=e.keyCode,a=!1;return(188===t||9===t||13===t)&&(a=!0),a},c.prototype.inputFocused=function(){var e=this;e.fixInputWidth(),e.container.classList.contains(e.options.containerFocusClass)||e.container.classList.add(e.options.containerFocusClass),e.options.placeholder&&(e.placeholder.style.opacity=0)},c.prototype.inputBlurred=function(){var e=this;e.tag_input.value="",e.setInputWidth(),e.container.classList.contains(e.options.containerFocusClass)&&e.container.classList.remove(e.options.containerFocusClass),!e.tags.length&&e.options.placeholder&&(e.placeholder.style.opacity=1)},c.prototype.keydownEvents=function(t){t=t||e.event;var a=this;a.listenForEndOfContainer(),a.isConfirmKey(t)&&""!==a.tag_input.value&&a.listenForTagConfirm(t),a.chargeLastTag(t)},c.prototype.keyupEvents=function(t){t=t||e.event},c.prototype.listenForTagConfirm=function(t){t=t||e.event;var a,n=this,o=t.keyCode;(9===o||13===o)&&(a=n.checkForDupes()),(!a||n.options.allowDuplicates)&&n.add(),t.preventDefault?t.preventDefault():t.returnValue=!1},c.prototype.listenForEndOfContainer=function(){var e=this,t=4.5*(e.options.fontSize/8)*e.tag_input.value.length,a=s.container.rect.width-s.container.side_padding;t+5>parseInt(e.tag_input.style.width,10)&&(e.tag_input.style.width=a+"px")},c.prototype.removeTag=function(t){t=t||e.event;var a=this,n=t.target||t,o=n.parentNode;o.parentNode.removeChild(o),a.inputFocused(),a.removeFromTheTags(n)},e.Taggle=c})(window,document);