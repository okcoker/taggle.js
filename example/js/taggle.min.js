/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.7.1
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
!function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),window.getComputedStyle||(window.getComputedStyle=function(a){return a.currentStyle}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;if(b=0,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&b!=1/0&&b!=-(1/0)&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),b>=e)return-1;for(c=b>=0?b:Math.max(e-Math.abs(b),0);e>c;c++)if(c in d&&d[c]===a)return c;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d})}(),function(){"undefined"==typeof document||"classList"in document.documentElement||!function(a){"use strict";if("HTMLElement"in a||"Element"in a){var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b=arguments,c=0,d=b.length,e=!1;do{a=b[c]+"";var f=i(this,a);-1!==f&&(this.splice(f,1),e=!0)}while(++c<d);e&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(self)}(),function(a,b){"use strict";function c(){for(var a=arguments[0],b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}function d(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function e(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function f(a){return a.replace(/^\s+|\s+$/g,"")}function g(b,c){a.attachEvent&&!a.addEventListener?b.innerText=c:b.textContent=c}var h=function(){},i={additionalTagClasses:"",allowDuplicates:!1,saveOnBlur:!1,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:!0,hiddenInputName:"taggles[]",tags:[],allowedTags:[],disallowedTags:[],maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[],preserveCase:!1,tagFormatter:h,onBeforeTagAdd:h,onTagAdd:h,onBeforeTagRemove:h,onTagRemove:h},j=8,k=188,l=9,m=13,n=function(a,d){this.settings=c({},i,d),this.measurements={container:{rect:null,style:null,padding:null}},this.container=a,this.tag={values:[],elements:[]},this.list=b.createElement("ul"),this.inputLi=b.createElement("li"),this.input=b.createElement("input"),this.sizer=b.createElement("div"),this.pasting=!1,this.placeholder=null,this.settings.placeholder&&(this.placeholder=b.createElement("span")),this.settings.submitKeys.length||(this.settings.submitKeys=[k,l,m]),"string"==typeof a&&(this.container=b.getElementById(a)),this._getMeasurements(),this._setupTextarea(),this._attachEvents()};n.prototype._getMeasurements=function(){var b,c,d;this.measurements.container.rect=this.container.getBoundingClientRect(),this.measurements.container.style=a.getComputedStyle(this.container),b=this.measurements.container.style,c=parseInt(b["padding-left"]||b.paddingLeft,10),d=parseInt(b["padding-right"]||b.paddingRight,10),this.measurements.container.padding=c+d},n.prototype._setupTextarea=function(){var b;if(this.list.className="taggle_list",this.input.type="text",this.input.className="taggle_input",this.input.tabIndex=this.settings.tabIndex,this.sizer.className="taggle_sizer",this.settings.tags.length)for(var c=0,d=this.settings.tags.length;d>c;c++){var e=this._createTag(this.settings.tags[c]);this.list.appendChild(e)}this.placeholder&&(this.placeholder.style.opacity=0,this.placeholder.classList.add("taggle_placeholder"),this.container.appendChild(this.placeholder),g(this.placeholder,this.settings.placeholder),this.settings.tags.length||(this.placeholder.style.opacity=1)),this.inputLi.appendChild(this.input),this.list.appendChild(this.inputLi),this.container.appendChild(this.list),this.container.appendChild(this.sizer),b=a.getComputedStyle(this.input).fontSize,this.sizer.style.fontSize=b},n.prototype._attachEvents=function(){var a=this;this.settings.focusInputOnContainerClick&&e(this.container,"click",function(){a.input.focus()}),e(this.input,"focus",this._focusInput.bind(this)),e(this.input,"blur",this._blurEvent.bind(this)),e(this.input,"keydown",this._keydownEvents.bind(this)),e(this.input,"keyup",this._keyupEvents.bind(this))},n.prototype._fixInputWidth=function(){var a,b,c,d,e;this._setInputWidth(),b=this.input.getBoundingClientRect(),c=this.measurements.container.rect,a=~~c.width,a||(a=~~c.right-~~c.left),d=~~b.left-~~c.left,e=this.measurements.container.padding,this._setInputWidth(a-d-e)},n.prototype._canAdd=function(a,b){if(!b)return!1;var c=this.settings.maxTags;if(null!==c&&c<=this.getTagValues().length)return!1;if(this.settings.onBeforeTagAdd(a,b)===!1)return!1;if(!this.settings.allowDuplicates&&this._hasDupes(b))return!1;var d=this.settings.preserveCase,e=this.settings.allowedTags;if(e.length&&!this._tagIsInArray(b,e,d))return!1;var f=this.settings.disallowedTags;return!f.length||!this._tagIsInArray(b,f,d)},n.prototype._tagIsInArray=function(a,b,c){if(c)return-1!==b.indexOf(a);var d=[].slice.apply(b).map(function(a){return a.toLowerCase()});return-1!==d.indexOf(a)},n.prototype._add=function(a,b){var c=this,d=b||"";"string"!=typeof b&&(d=f(this.input.value)),d.split(",").map(function(a){return c._formatTag(a)}).forEach(function(b){if(c._canAdd(a,b)){var d=c._createTag(b),e=c.list.children,f=e[e.length-1];c.list.insertBefore(d,f),c.settings.onTagAdd(a,b),c.input.value="",c._setInputWidth(),c._fixInputWidth(),c._focusInput()}})},n.prototype._checkLastTag=function(b){b=b||a.event;var c=this.container.querySelectorAll(".taggle"),d=c[c.length-1],e="taggle_hot",f=this.input.classList.contains("taggle_back");""!==this.input.value||b.keyCode!==j||f?d.classList.contains(e)&&d.classList.remove(e):d.classList.contains(e)?(this.input.classList.add("taggle_back"),this._remove(d,b),this._fixInputWidth(),this._focusInput()):d.classList.add(e)},n.prototype._setInputWidth=function(a){this.input.style.width=(a||10)+"px"},n.prototype._hasDupes=function(a){var b,c=this.tag.values.indexOf(a),d=this.container.querySelector(".taggle_list");if(this.settings.duplicateTagClass){b=d.querySelectorAll("."+this.settings.duplicateTagClass);for(var e=0,f=b.length;f>e;e++)b[e].classList.remove(this.settings.duplicateTagClass)}return c>-1?(this.settings.duplicateTagClass&&d.childNodes[c].classList.add(this.settings.duplicateTagClass),!0):!1},n.prototype._isConfirmKey=function(a){var b=!1;return this.settings.submitKeys.indexOf(a)>-1&&(b=!0),b},n.prototype._focusInput=function(){this._fixInputWidth(),this.container.classList.contains(this.settings.containerFocusClass)||this.container.classList.add(this.settings.containerFocusClass),this.placeholder&&(this.placeholder.style.opacity=0)},n.prototype._blurEvent=function(b){if(this.container.classList.contains(this.settings.containerFocusClass)&&this.container.classList.remove(this.settings.containerFocusClass),!this.tag.values.length&&this.placeholder&&(this.placeholder.style.opacity=1),this.settings.saveOnBlur){if(b=b||a.event,this._listenForEndOfContainer(),""!==this.input.value)return void this._confirmValidTagEvent(b);this.tag.values.length&&this._checkLastTag(b)}else this.input.value="",this._setInputWidth()},n.prototype._keydownEvents=function(b){b=b||a.event;var c=b.keyCode;return this.pasting=!1,this._listenForEndOfContainer(),86===c&&b.metaKey&&(this.pasting=!0),this._isConfirmKey(c)&&""!==this.input.value?void this._confirmValidTagEvent(b):void(this.tag.values.length&&this._checkLastTag(b))},n.prototype._keyupEvents=function(b){b=b||a.event,this.input.classList.remove("taggle_back"),g(this.sizer,this.input.value),this.pasting&&""!==this.input.value&&(this._add(b),this.pasting=!1)},n.prototype._confirmValidTagEvent=function(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1,this._add(b)},n.prototype._listenForEndOfContainer=function(){var a=this.sizer.getBoundingClientRect().width,b=this.measurements.container.rect.width-this.measurements.container.padding,c=parseInt(this.sizer.style.fontSize,10);a+1.5*c>parseInt(this.input.style.width,10)&&(this.input.style.width=b+"px")},n.prototype._createTag=function(a){var c=b.createElement("li"),d=b.createElement("button"),f=b.createElement("input"),h=b.createElement("span");a=this._formatTag(a),d.innerHTML="&times;",d.className="close",d.type="button",e(d,"click",this._remove.bind(this,d)),g(h,a),h.className="taggle_text",c.className="taggle "+this.settings.additionalTagClasses,f.type="hidden",f.value=a,f.name=this.settings.hiddenInputName,c.appendChild(h),c.appendChild(d),c.appendChild(f);var i=this.settings.tagFormatter(c);if("undefined"!=typeof i&&(c=i),!(c instanceof HTMLElement)||"LI"!==c.tagName)throw new Error("tagFormatter must return an li element");return this.tag.values.push(a),this.tag.elements.push(c),c},n.prototype._remove=function(a,b){var c,d,e,f;"li"!==a.tagName.toLowerCase()&&(a=a.parentNode),c=a.querySelector(".taggle_text"),d=c.innerText||c.textContent,this.settings.onBeforeTagRemove(b,d)!==!1&&(a.parentNode.removeChild(a),e="a"===a.tagName.toLowerCase()?a.parentNode:a,f=this.tag.elements.indexOf(e),this.tag.elements.splice(f,1),this.tag.values.splice(f,1),this.settings.onTagRemove(b,d),this._focusInput())},n.prototype._formatTag=function(a){return this.settings.preserveCase?a:a.toLowerCase()},n.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}},n.prototype.getTagElements=function(){return this.tag.elements},n.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)},n.prototype.getInput=function(){return this.input},n.prototype.getContainer=function(){return this.container},n.prototype.add=function(a){var b=d(a);if(b)for(var c=0,e=a.length;e>c;c++)"string"==typeof a[c]&&this._add(null,a[c]);else this._add(null,a);return this},n.prototype.remove=function(a,b){for(var c=this.tag.values.length-1,d=!1;c>-1&&(this.tag.values[c]===a&&(d=!0,this._remove(this.tag.elements[c])),!d||b);)c--;return this},n.prototype.removeAll=function(){for(var a=this.tag.values.length-1;a>=0;a--)this._remove(this.tag.elements[a]);return this},"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof exports?module.exports=n:a.Taggle=n}(window,document);